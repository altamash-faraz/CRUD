<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Professional CRUD - Database Management System</title>

    <!-- CSS Libraries -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary-color: #f59e0b;
        --success-color: #10b981;
        --error-color: #ef4444;
        --warning-color: #f59e0b;
        --dark-color: #1f2937;
        --light-color: #f9fafb;
        --border-color: #e5e7eb;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --border-radius: 8px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-color);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow-sm);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2rem;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .logo i {
        font-size: 2rem;
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--secondary-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .btn-header {
        padding: 0.5rem 1rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-header:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 2rem;
      }

      /* Dashboard Stats */
      .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        border-left: 4px solid var(--primary-color);
        transition: var(--transition);
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .stat-card h3 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
      }

      .stat-card p {
        color: var(--text-secondary);
        font-weight: 500;
      }

      .stat-card i {
        float: right;
        font-size: 2rem;
        color: var(--primary-color);
        opacity: 0.3;
      }

      /* Navigation Tabs */
      .nav-tabs {
        display: flex;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        margin-bottom: 2rem;
        overflow: hidden;
      }

      .nav-tab {
        flex: 1;
        padding: 1rem 2rem;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .nav-tab.active {
        background: var(--primary-color);
        color: white;
      }

      .nav-tab:not(.active):hover {
        background: var(--light-color);
      }

      /* Content Sections */
      .content-section {
        display: none;
        animation: slideInUp 0.5s ease-out;
      }

      .content-section.active {
        display: block;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Form Styles */
      .form-card {
        background: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .form-group label {
        font-weight: 600;
        color: var(--text-primary);
      }

      .form-input,
      .form-select,
      .form-textarea {
        padding: 0.75rem;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
        font-family: inherit;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }

      .tags-input {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        padding: 0.5rem;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        background: white;
        min-height: 3rem;
      }

      .tags-input:focus-within {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .tag {
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .tag-remove {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1rem;
        padding: 0;
        display: flex;
        align-items: center;
      }

      .tag-input {
        border: none;
        outline: none;
        flex: 1;
        min-width: 100px;
      }

      /* Button Styles */
      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        justify-content: center;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      .btn-success {
        background: var(--success-color);
        color: white;
      }

      .btn-warning {
        background: var(--warning-color);
        color: white;
      }

      .btn-danger {
        background: var(--error-color);
        color: white;
      }

      .btn-secondary {
        background: var(--text-secondary);
        color: white;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* Filters and Search */
      .filters-section {
        background: white;
        padding: 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
      }

      .filters-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto auto;
        gap: 1rem;
        align-items: end;
      }

      .search-input {
        position: relative;
      }

      .search-input i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
      }

      .search-input input {
        padding-left: 3rem;
      }

      /* Products Grid */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
      }

      .product-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        transition: var(--transition);
        position: relative;
      }

      .product-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
      }

      .product-header {
        padding: 1.5rem;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        position: relative;
      }

      .product-category {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        backdrop-filter: blur(10px);
      }

      .product-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .product-price {
        font-size: 1.5rem;
        font-weight: 700;
      }

      .product-body {
        padding: 1.5rem;
      }

      .product-description {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        line-height: 1.5;
      }

      .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .product-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .product-tag {
        background: var(--light-color);
        color: var(--text-secondary);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
      }

      .product-actions {
        display: flex;
        gap: 0.5rem;
      }

      .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin: 2rem 0;
      }

      .pagination button {
        padding: 0.5rem 1rem;
        border: 2px solid var(--border-color);
        background: white;
        color: var(--text-primary);
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
      }

      .pagination button:hover:not(:disabled) {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .pagination button.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Loading States */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--border-color);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Alerts */
      .alert {
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        animation: slideInDown 0.3s ease-out;
      }

      .alert-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(16, 185, 129, 0.2);
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error-color);
        border: 1px solid rgba(239, 68, 68, 0.2);
      }

      .alert-warning {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-color);
        border: 1px solid rgba(245, 158, 11, 0.2);
      }

      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Empty States */
      .empty-state {
        text-align: center;
        padding: 3rem;
        color: var(--text-secondary);
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
      }

      .empty-state h3 {
        margin-bottom: 1rem;
        color: var(--text-primary);
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease-out;
      }

      .modal {
        background: white;
        border-radius: var(--border-radius);
        max-width: 90vw;
        max-height: 90vh;
        overflow-y: auto;
        animation: scaleIn 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .header-content {
          padding: 0 1rem;
          flex-direction: column;
          gap: 1rem;
        }

        .container {
          padding: 0 1rem;
        }

        .filters-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .products-grid {
          grid-template-columns: 1fr;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .nav-tabs {
          flex-direction: column;
        }

        .dashboard-stats {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .product-actions {
          flex-direction: column;
        }

        .btn {
          font-size: 0.875rem;
          padding: 0.625rem 1rem;
        }
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--light-color);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-database"></i>
          <span>Professional CRUD</span>
        </div>
        <div class="header-actions">
          <button class="btn-header" onclick="exportData()">
            <i class="fas fa-download"></i>
            Export Data
          </button>
          <button class="btn-header" onclick="refreshDashboard()">
            <i class="fas fa-sync-alt"></i>
            Refresh
          </button>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="container">
      <!-- Dashboard Stats -->
      <div class="dashboard-stats" id="dashboardStats">
        <div class="stat-card">
          <i class="fas fa-box"></i>
          <h3 id="totalProducts">-</h3>
          <p>Total Products</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-tags"></i>
          <h3 id="totalCategories">-</h3>
          <p>Categories</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-chart-line"></i>
          <h3 id="activeProducts">-</h3>
          <p>Active Products</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-dollar-sign"></i>
          <h3 id="totalValue">-</h3>
          <p>Inventory Value</p>
        </div>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('products')">
          <i class="fas fa-box"></i>
          Products
        </button>
        <button class="nav-tab" onclick="switchTab('categories')">
          <i class="fas fa-tags"></i>
          Categories
        </button>
        <button class="nav-tab" onclick="switchTab('analytics')">
          <i class="fas fa-chart-bar"></i>
          Analytics
        </button>
        <button class="nav-tab" onclick="switchTab('add-product')">
          <i class="fas fa-plus"></i>
          Add Product
        </button>
      </div>

      <!-- Alert Container -->
      <div id="alertContainer"></div>

      <!-- Products Section -->
      <div id="products-section" class="content-section active">
        <!-- Filters -->
        <div class="filters-section">
          <div class="filters-grid">
            <div class="search-input">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="searchInput"
                class="form-input"
                placeholder="Search products..."
              />
            </div>
            <select id="categoryFilter" class="form-select">
              <option value="">All Categories</option>
            </select>
            <select id="statusFilter" class="form-select">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="discontinued">Discontinued</option>
            </select>
            <button class="btn btn-primary" onclick="applyFilters()">
              <i class="fas fa-filter"></i>
              Filter
            </button>
            <button class="btn btn-secondary" onclick="clearFilters()">
              <i class="fas fa-times"></i>
              Clear
            </button>
          </div>
        </div>

        <!-- Products Grid -->
        <div id="productsContainer">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>

        <!-- Pagination -->
        <div id="paginationContainer"></div>
      </div>

      <!-- Categories Section -->
      <div id="categories-section" class="content-section">
        <div class="form-card">
          <h2>Add New Category</h2>
          <form id="categoryForm" class="form-grid">
            <div class="form-group">
              <label for="categoryName">Category Name</label>
              <input
                type="text"
                id="categoryName"
                class="form-input"
                required
              />
            </div>
            <div class="form-group">
              <label for="categoryDescription">Description</label>
              <textarea
                id="categoryDescription"
                class="form-textarea"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="categoryColor">Color</label>
              <input
                type="color"
                id="categoryColor"
                class="form-input"
                value="#007bff"
              />
            </div>
            <div class="form-group">
              <label for="categoryIcon">Icon Class</label>
              <input
                type="text"
                id="categoryIcon"
                class="form-input"
                value="fas fa-box"
                placeholder="fas fa-box"
              />
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Add Category
              </button>
            </div>
          </form>
        </div>

        <div id="categoriesContainer">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </div>

      <!-- Analytics Section -->
      <div id="analytics-section" class="content-section">
        <div class="form-card">
          <h2>Analytics Dashboard</h2>
          <div id="analyticsContainer">
            <div class="loading">
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Product Section -->
      <div id="add-product-section" class="content-section">
        <div class="form-card">
          <h2 id="productFormTitle">Add New Product</h2>
          <form id="productForm" class="form-grid">
            <input type="hidden" id="productId" />
            <div class="form-group">
              <label for="productName">Product Name *</label>
              <input type="text" id="productName" class="form-input" required />
            </div>
            <div class="form-group">
              <label for="productCategory">Category *</label>
              <select id="productCategory" class="form-select" required>
                <option value="">Select Category</option>
              </select>
            </div>
            <div class="form-group">
              <label for="productPrice">Price *</label>
              <input
                type="number"
                id="productPrice"
                class="form-input"
                step="0.01"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="productQuantity">Quantity *</label>
              <input
                type="number"
                id="productQuantity"
                class="form-input"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="productStatus">Status</label>
              <select id="productStatus" class="form-select">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="discontinued">Discontinued</option>
              </select>
            </div>
            <div class="form-group" style="grid-column: span 2">
              <label for="productDescription">Description *</label>
              <textarea
                id="productDescription"
                class="form-textarea"
                required
              ></textarea>
            </div>
            <div class="form-group" style="grid-column: span 2">
              <label>Tags</label>
              <div class="tags-input" id="tagsInput">
                <input
                  type="text"
                  class="tag-input"
                  placeholder="Type and press Enter to add tags..."
                />
              </div>
            </div>
            <div class="form-group" style="grid-column: span 2">
              <div style="display: flex; gap: 1rem">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i>
                  <span id="submitButtonText">Add Product</span>
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  onclick="resetProductForm()"
                >
                  <i class="fas fa-times"></i>
                  Cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // Global variables
      let currentPage = 1;
      let currentFilters = {};
      let categories = [];
      let products = [];
      let currentEditingProduct = null;

      // API Base URL
      const API_BASE = "";

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        initializeApp();
      });

      async function initializeApp() {
        try {
          await loadDashboardStats();
          await loadCategories();
          await loadProducts();
          setupEventListeners();
        } catch (error) {
          showAlert("Failed to initialize application", "error");
          console.error("Initialization error:", error);
        }
      }

      function setupEventListeners() {
        // Product form
        document
          .getElementById("productForm")
          .addEventListener("submit", handleProductSubmit);

        // Category form
        document
          .getElementById("categoryForm")
          .addEventListener("submit", handleCategorySubmit);

        // Search input
        document
          .getElementById("searchInput")
          .addEventListener("input", debounce(applyFilters, 300));

        // Tags input
        setupTagsInput();

        // Auto refresh every 30 seconds
        setInterval(refreshDashboard, 30000);
      }

      // Dashboard functions
      async function loadDashboardStats() {
        try {
          const response = await fetch(`${API_BASE}/api/analytics/dashboard`);
          if (!response.ok) throw new Error("Failed to load dashboard stats");

          const data = await response.json();
          updateDashboardStats(data.summary);
        } catch (error) {
          console.error("Dashboard stats error:", error);
        }
      }

      function updateDashboardStats(stats) {
        document.getElementById("totalProducts").textContent =
          stats.total_products || 0;
        document.getElementById("totalCategories").textContent =
          stats.total_categories || 0;
        document.getElementById("activeProducts").textContent =
          stats.active_products || 0;
        document.getElementById("totalValue").textContent = `$${(
          stats.total_inventory_value || 0
        ).toLocaleString()}`;
      }

      // Categories functions
      async function loadCategories() {
        try {
          const response = await fetch(`${API_BASE}/api/categories`);
          if (!response.ok) throw new Error("Failed to load categories");

          categories = await response.json();
          updateCategorySelects();
          renderCategories();
        } catch (error) {
          console.error("Categories error:", error);
          showAlert("Failed to load categories", "error");
        }
      }

      function updateCategorySelects() {
        const selects = ["categoryFilter", "productCategory"];
        selects.forEach((selectId) => {
          const select = document.getElementById(selectId);
          const currentValue = select.value;

          // Keep existing options, add new ones
          const existingOptions = Array.from(select.options).slice(1); // Skip first option
          const existingValues = existingOptions.map((opt) => opt.value);

          categories.forEach((category) => {
            if (!existingValues.includes(category._id)) {
              const option = document.createElement("option");
              option.value = category._id;
              option.textContent = category.name;
              select.appendChild(option);
            }
          });

          select.value = currentValue;
        });
      }

      function renderCategories() {
        const container = document.getElementById("categoriesContainer");

        if (categories.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tags"></i>
                        <h3>No Categories Found</h3>
                        <p>Create your first category using the form above.</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = `
                <div class="products-grid">
                    ${categories
                      .map(
                        (category) => `
                        <div class="product-card">
                            <div class="product-header" style="background: ${
                              category.color
                            };">
                                <div class="product-title">
                                    <i class="${category.icon}"></i>
                                    ${category.name}
                                </div>
                                <div class="product-price">${
                                  category.product_count || 0
                                } products</div>
                            </div>
                            <div class="product-body">
                                <p class="product-description">${
                                  category.description || "No description"
                                }</p>
                                <div class="product-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editCategory('${
                                      category._id
                                    }')">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteCategory('${
                                      category._id
                                    }')">
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      async function handleCategorySubmit(e) {
        e.preventDefault();

        const formData = {
          name: document.getElementById("categoryName").value,
          description: document.getElementById("categoryDescription").value,
          color: document.getElementById("categoryColor").value,
          icon: document.getElementById("categoryIcon").value,
        };

        try {
          const response = await fetch(`${API_BASE}/api/categories`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "Failed to create category");
          }

          showAlert("Category created successfully!", "success");
          document.getElementById("categoryForm").reset();
          await loadCategories();
          await loadDashboardStats();
        } catch (error) {
          showAlert(error.message, "error");
        }
      }

      // Products functions
      async function loadProducts() {
        const params = new URLSearchParams({
          page: currentPage,
          ...currentFilters,
        });

        try {
          const response = await fetch(`${API_BASE}/api/products?${params}`);
          if (!response.ok) throw new Error("Failed to load products");

          const data = await response.json();
          products = data.products;
          renderProducts(data.products);
          renderPagination(data.pagination);
        } catch (error) {
          console.error("Products error:", error);
          showAlert("Failed to load products", "error");
        }
      }

      function renderProducts(products) {
        const container = document.getElementById("productsContainer");

        if (products.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box"></i>
                        <h3>No Products Found</h3>
                        <p>Start by adding your first product or adjust your filters.</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = `
                <div class="products-grid">
                    ${products
                      .map(
                        (product) => `
                        <div class="product-card">
                            <div class="product-header">
                                <div class="product-category" style="background: ${
                                  product.category?.color || "#007bff"
                                };">
                                    <i class="${
                                      product.category?.icon || "fas fa-box"
                                    }"></i>
                                    ${product.category?.name || "Uncategorized"}
                                </div>
                                <div class="product-title">${product.name}</div>
                                <div class="product-price">$${product.price.toFixed(
                                  2
                                )}</div>
                            </div>
                            <div class="product-body">
                                <p class="product-description">${
                                  product.description
                                }</p>
                                <div class="product-meta">
                                    <span>Qty: ${product.quantity}</span>
                                    <span>Status: ${product.status}</span>
                                    <span>Views: ${product.views || 0}</span>
                                </div>
                                ${
                                  product.tags && product.tags.length > 0
                                    ? `
                                    <div class="product-tags">
                                        ${product.tags
                                          .map(
                                            (tag) =>
                                              `<span class="product-tag">${tag}</span>`
                                          )
                                          .join("")}
                                    </div>
                                `
                                    : ""
                                }
                                <div class="product-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editProduct('${
                                      product._id
                                    }')">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteProduct('${
                                      product._id
                                    }')">
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      function renderPagination(pagination) {
        const container = document.getElementById("paginationContainer");

        if (pagination.total_pages <= 1) {
          container.innerHTML = "";
          return;
        }

        let paginationHTML = '<div class="pagination">';

        // Previous button
        paginationHTML += `
                <button ${
                  pagination.has_prev ? "" : "disabled"
                } onclick="changePage(${pagination.page - 1})">
                    <i class="fas fa-chevron-left"></i>
                    Previous
                </button>
            `;

        // Page numbers
        const startPage = Math.max(1, pagination.page - 2);
        const endPage = Math.min(pagination.total_pages, pagination.page + 2);

        for (let i = startPage; i <= endPage; i++) {
          paginationHTML += `
                    <button class="${
                      i === pagination.page ? "active" : ""
                    }" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
        }

        // Next button
        paginationHTML += `
                <button ${
                  pagination.has_next ? "" : "disabled"
                } onclick="changePage(${pagination.page + 1})">
                    Next
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

        paginationHTML += "</div>";
        container.innerHTML = paginationHTML;
      }

      async function handleProductSubmit(e) {
        e.preventDefault();

        const tags = Array.from(document.querySelectorAll("#tagsInput .tag"))
          .map((tag) => tag.textContent.replace("×", "").trim())
          .filter((tag) => tag);

        const formData = {
          name: document.getElementById("productName").value,
          description: document.getElementById("productDescription").value,
          category_id: document.getElementById("productCategory").value,
          price: parseFloat(document.getElementById("productPrice").value),
          quantity: parseInt(document.getElementById("productQuantity").value),
          status: document.getElementById("productStatus").value,
          tags: tags,
        };

        try {
          const productId = document.getElementById("productId").value;
          const isEdit = productId && productId !== "";

          const response = await fetch(
            `${API_BASE}/api/products${isEdit ? "/" + productId : ""}`,
            {
              method: isEdit ? "PUT" : "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            }
          );

          if (!response.ok) {
            const error = await response.json();
            throw new Error(
              error.error || `Failed to ${isEdit ? "update" : "create"} product`
            );
          }

          showAlert(
            `Product ${isEdit ? "updated" : "created"} successfully!`,
            "success"
          );
          resetProductForm();
          await loadProducts();
          await loadDashboardStats();

          if (isEdit) {
            switchTab("products");
          }
        } catch (error) {
          showAlert(error.message, "error");
        }
      }

      // Product CRUD operations
      async function editProduct(productId) {
        try {
          const response = await fetch(`${API_BASE}/api/products/${productId}`);
          if (!response.ok) throw new Error("Failed to load product");

          const product = await response.json();
          populateProductForm(product);
          switchTab("add-product");
        } catch (error) {
          showAlert("Failed to load product for editing", "error");
        }
      }

      function populateProductForm(product) {
        document.getElementById("productId").value = product._id;
        document.getElementById("productName").value = product.name;
        document.getElementById("productDescription").value =
          product.description;
        document.getElementById("productCategory").value = product.category_id;
        document.getElementById("productPrice").value = product.price;
        document.getElementById("productQuantity").value = product.quantity;
        document.getElementById("productStatus").value = product.status;

        // Populate tags
        const tagsContainer = document.getElementById("tagsInput");
        const existingTags = tagsContainer.querySelectorAll(".tag");
        existingTags.forEach((tag) => tag.remove());

        if (product.tags) {
          product.tags.forEach((tagText) => {
            const tag = createTag(tagText);
            tagsContainer.insertBefore(
              tag,
              tagsContainer.querySelector(".tag-input")
            );
          });
        }

        // Update form title and button
        document.getElementById("productFormTitle").textContent =
          "Edit Product";
        document.getElementById("submitButtonText").textContent =
          "Update Product";
        currentEditingProduct = product._id;
      }

      function resetProductForm() {
        document.getElementById("productForm").reset();
        document.getElementById("productId").value = "";

        // Clear tags
        const existingTags = document.querySelectorAll("#tagsInput .tag");
        existingTags.forEach((tag) => tag.remove());

        // Reset form title and button
        document.getElementById("productFormTitle").textContent =
          "Add New Product";
        document.getElementById("submitButtonText").textContent = "Add Product";
        currentEditingProduct = null;
      }

      async function deleteProduct(productId) {
        if (!confirm("Are you sure you want to delete this product?")) return;

        try {
          const response = await fetch(
            `${API_BASE}/api/products/${productId}`,
            {
              method: "DELETE",
            }
          );

          if (!response.ok) throw new Error("Failed to delete product");

          showAlert("Product deleted successfully!", "success");
          await loadProducts();
          await loadDashboardStats();
        } catch (error) {
          showAlert("Failed to delete product", "error");
        }
      }

      // Filter and search functions
      function applyFilters() {
        currentFilters = {
          search: document.getElementById("searchInput").value,
          category_id: document.getElementById("categoryFilter").value,
          status: document.getElementById("statusFilter").value,
        };

        // Remove empty filters
        Object.keys(currentFilters).forEach((key) => {
          if (!currentFilters[key]) {
            delete currentFilters[key];
          }
        });

        currentPage = 1;
        loadProducts();
      }

      function clearFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("categoryFilter").value = "";
        document.getElementById("statusFilter").value = "";
        currentFilters = {};
        currentPage = 1;
        loadProducts();
      }

      function changePage(page) {
        currentPage = page;
        loadProducts();
      }

      // Navigation functions
      function switchTab(tabName) {
        // Remove active class from all tabs and sections
        document
          .querySelectorAll(".nav-tab")
          .forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".content-section")
          .forEach((section) => section.classList.remove("active"));

        // Add active class to clicked tab and corresponding section
        event?.target.classList.add("active");
        document.getElementById(`${tabName}-section`).classList.add("active");

        // Load data for specific tabs
        if (tabName === "analytics") {
          loadAnalytics();
        }
      }

      // Tags input functionality
      function setupTagsInput() {
        const tagInput = document.querySelector("#tagsInput .tag-input");

        tagInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            const tagText = this.value.trim();
            if (tagText) {
              const tag = createTag(tagText);
              this.parentNode.insertBefore(tag, this);
              this.value = "";
            }
          }
        });
      }

      function createTag(text) {
        const tag = document.createElement("div");
        tag.className = "tag";
        tag.innerHTML = `
                ${text}
                <button type="button" class="tag-remove" onclick="this.parentNode.remove()">×</button>
            `;
        return tag;
      }

      // Analytics functions
      async function loadAnalytics() {
        const container = document.getElementById("analyticsContainer");

        try {
          const response = await fetch(`${API_BASE}/api/analytics/dashboard`);
          if (!response.ok) throw new Error("Failed to load analytics");

          const data = await response.json();
          renderAnalytics(data);
        } catch (error) {
          container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Analytics Not Available</h3>
                        <p>Failed to load analytics data.</p>
                    </div>
                `;
        }
      }

      function renderAnalytics(data) {
        const container = document.getElementById("analyticsContainer");

        container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div class="form-card">
                        <h3>Products by Category</h3>
                        ${data.charts.products_by_category
                          .map(
                            (item) => `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                <span>${item.category_name}</span>
                                <span><strong>${item.count}</strong></span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    
                    <div class="form-card">
                        <h3>Top Viewed Products</h3>
                        ${data.charts.top_viewed_products
                          .map(
                            (item) => `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                <span>${item.name}</span>
                                <span><strong>${item.views} views</strong></span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    
                    <div class="form-card">
                        <h3>Status Distribution</h3>
                        ${data.charts.status_distribution
                          .map(
                            (item) => `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                <span style="text-transform: capitalize;">${item._id}</span>
                                <span><strong>${item.count}</strong></span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    
                    <div class="form-card">
                        <h3>Price Statistics</h3>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                            <span>Average Price</span>
                            <span><strong>$${
                              data.price_stats.average
                            }</strong></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                            <span>Minimum Price</span>
                            <span><strong>$${
                              data.price_stats.minimum
                            }</strong></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                            <span>Maximum Price</span>
                            <span><strong>$${
                              data.price_stats.maximum
                            }</strong></span>
                        </div>
                    </div>
                </div>
            `;
      }

      // Utility functions
      function showAlert(message, type = "success") {
        const container = document.getElementById("alertContainer");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;

        const icon =
          type === "success"
            ? "check-circle"
            : type === "error"
            ? "exclamation-circle"
            : "exclamation-triangle";
        alert.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;

        container.appendChild(alert);

        // Auto remove after 5 seconds
        setTimeout(() => {
          alert.remove();
        }, 5000);
      }

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      async function refreshDashboard() {
        await loadDashboardStats();
        await loadProducts();
      }

      async function exportData() {
        try {
          const response = await fetch(
            `${API_BASE}/api/export/products?format=csv`
          );
          if (!response.ok) throw new Error("Failed to export data");

          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `products_${new Date().toISOString().split("T")[0]}.csv`;
          a.click();
          window.URL.revokeObjectURL(url);

          showAlert("Data exported successfully!", "success");
        } catch (error) {
          showAlert("Failed to export data", "error");
        }
      }
    </script>
  </body>
</html>
